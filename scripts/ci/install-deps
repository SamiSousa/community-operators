#!/usr/bin/env bash

set -ex

# Don't use sudo when running in a container.
SUDO=sudo
if [ -f /.dockerenv ]; then
  SUDO=
fi

# jq, yq
curl -Lo jq https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64
chmod +x jq
$SUDO mv jq /usr/local/bin/
curl -Lo yq https://github.com/mikefarah/yq/releases/download/2.2.1/yq_linux_amd64
chmod +x yq
$SUDO mv yq /usr/local/bin/
# python3, operator-courier
$SUDO apt-get install python3
pip3 install operator-courier==1.0.2
# SDK
# TODO(estroz): use curl download method once v0.6.0 is released, which contains scorecard updates.
# SDK_VER="v0.6.0"
# curl -Lo operator-sdk "https://github.com/operator-framework/operator-sdk/releases/download/${SDK_VER}/operator-sdk-${SDK_VER}-x86_64-linux-gnu"
SDK_REPO_PATH="github.com/operator-framework/operator-sdk"
go get -d "$SDK_REPO_PATH" || true
pushd "${GOPATH}/src/${SDK_REPO_PATH}"
GO111MODULE=off make build/operator-sdk
chmod +x build/operator-sdk
$SUDO mv build/operator-sdk /usr/local/bin/
popd
# helm
curl https://raw.githubusercontent.com/helm/helm/master/scripts/get | bash
# kubectl
KUBE_VER="v1.13.0"
curl -Lo kubectl "https://storage.googleapis.com/kubernetes-release/release/${KUBE_VER}/bin/linux/amd64/kubectl"
chmod +x kubectl
$SUDO mv kubectl /usr/local/bin/
# minikube and crictl dependency
curl -Lo crictl.tar.gz "https://github.com/kubernetes-sigs/cri-tools/releases/download/${KUBE_VER}/crictl-${KUBE_VER}-linux-amd64.tar.gz"
tar -zxvf crictl.tar.gz
chmod +x crictl
$SUDO mv crictl /usr/local/bin/
rm crictl.tar.gz
curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
chmod +x minikube
$SUDO mv minikube /usr/local/bin/
